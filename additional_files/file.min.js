!function(a){"use strict";function b(a){var b,c,d,e,g=this.id;for(titleArr[g]=$("title",a).text(),d=$("<h3 />").attr("id",tmpArr[g]).html(titleArr[g]+" [#"+tmpArr[g]+"]:"),c=$("pre",a).prop("outerHTML"),e=$("<div />").html(c).attr("data-id",g),b=g-1;b>=0&&!f[b];--b);-1==b?($("#templates > div.cen").after(e).after(d),console.log("A:",b)):($("#templates > div[data-id="+b+"]").after(e).after(d),console.log("B:",b)),f[g]=!0}function c(){var b,c,d,f,g,h,i,j=0;for(Rows=[],e=strBack.split("\n"),b=0;b<e.length;++b)if(e[b]){if(f=e[b].replace(/[\f\n\r\v]/g,"").split("|"),4!==f.length)continue;d=f[0],g=$("<tr />"),g.append(h=$("<td />").data("id",b)),g.append(h=$("<td />").html(f[0])),g.append(h=$("<td />")),g.append(h=$("<td />").html(f[1])),g.append(h=$("<td />").html(f[2])),g.data("priority",parseInt(f[3])),Rows.push(g.get(0)),++j}for(b=0;b<Rows.length;++b)h=$(Rows[b].cells[0]),h.html(c=j-h.data("id")).removeData(),h=$(Rows[b].cells[2]),i=$('<a href="memos/'+c+'.html" target="_blank">链接</a>'),h.append(i);for(Rows.sort(function(a,b){return $(b).data("priority")-$(a).data("priority")}),b=0;b<Rows.length;++b)$(Rows[b]).removeData();$("#memTable").append(Rows.slice((curPage-1)*MEMOS_PER_PAGE,curPage*MEMOS_PER_PAGE)),$("#memTotal").html("scx: 共 "+j+" 份便笺"),a.totPage=Math.ceil(j/RECORDS_PER_PAGE)}var d,e,f;const g="今天运气不怎么好，和 scx 喝口茶再试试吧";a.parseRecords=function(b){var c,e,f,g,h,i,j,k=0,l=0;for(Rows=[],d=b.split("\n"),c=0;c<d.length;++c)if(d[c]){if(f=d[c].replace(/[\f\n\r\v]/g,"").split("|"),5!==f.length)continue;++l,g=OJMatch(curLocation,e=f[0]),g&&(h=$("<tr />"),h.append(i=$("<td />").data("id",l-1)),h.append(i=$("<td />").html(g)),j=$('<a href="records/'+escape(e)+'.html" target="_blank">链接</a>'),h.append(i=$("<td />").append(j)),h.append(i=$("<td />").html(f[1])),h.append(i=$("<td />").html(f[2])),h.append(i=$("<td />").html(f[3])),h.append(i=$("<td />").html(f[4])),Rows.push(h.get(0)),++k)}for(c=0;c<Rows.length;++c)i=$(Rows[c].cells[0]),i.html(l-i.data("id")).removeData();"nr"===curROrder?tableReverse():"n"!==curROrder&&sortTable(curROrder),$("#recTable").append(Rows.slice((curPage-1)*RECORDS_PER_PAGE,curPage*RECORDS_PER_PAGE)),$("#recTotal").html("scx: "+(k?(curLocation?"当前筛选下":"")+"共有 "+k+" 条记录":"怎么一道题都还没有啊，快点做题了！")),a.totPage=Math.ceil(k/RECORDS_PER_PAGE),pagination()},a.getTemplates=function(a){tmpArr=a.split("\n"),titleArr=[],f=[];var c,d;for(c in tmpArr){if(d=tmpArr[c]=tmpArr[c].replace(/[\f\n\r\v]/g,""),!d.length)return;$.ajax("templates/"+d+".xml",{type:"GET",dataType:"xml",id:parseInt(c),success:b})}},a.LoadMemos=function(){strBack="",xhr.onreadystatechange=function(){4===xhr.readyState&&(200===xhr.status||0===xhr.status?(strBack=xhr.responseText,c()):alert(g))},xhr.open("GET","memos/tot.cfg",!0),xhr.send(null)}}(window?window:this);