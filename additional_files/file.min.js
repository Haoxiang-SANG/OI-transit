var xh,xs,recarr,tearr,tetiarr,memarr;var strBack,xmlBack;var strFilter,pageO,pageC,nowId;const RECORDS_PER_PAGE=50,MEMOS_PER_PAGE=50;const failed="今天运气不怎么好，和 scx 喝口茶再试试吧";function LoadRecords(){strBack="";xh=new XMLHttpRequest();xh.onreadystatechange=read_ok1;xh.open("GET","records/tot.cfg",true);xh.send(null)}function DecRecords(){var e=0,n="",a,j=0,l=0;var m,k,h,g,f,d,c,b;recarr=strBack.split("\n");for(e in recarr){if(recarr[e]!==""){a=recarr[e].replace(/[\f\n\r\v]/g,"").split("|");if(a.length!==5){continue}++l;n=a[0];if(Matching(strFilter,n)){m=recTable.tBodies[0].insertRow();k=m.insertCell();k.innerHTML=(l-1).toString();h=m.insertCell();h.innerHTML=prToHTML(n);g=m.insertCell();g.innerHTML='<a href="records/'+n.replace(/#/g,"%23")+'.html" target="_blank">链接</a>';f=m.insertCell();f.innerHTML=a[1];d=m.insertCell();d.innerHTML=a[2];c=m.insertCell();c.innerHTML=a[3];b=m.insertCell();b.innerHTML=a[4];++j;if(j<=(pageO-1)*RECORDS_PER_PAGE||pageO*RECORDS_PER_PAGE<j){m.style.display="none"}}}}for(e=0;e<j;++e){k=recTable.tBodies[0].rows[e].cells[0];k.innerHTML=(l-parseInt(k.innerHTML)).toString()}if(j){if(strFilter===""){recTotal.innerHTML="scx: 共做了 "+j+" 道题"}else{recTotal.innerHTML="scx: 当前筛选下共有 "+j+" 道题"}}else{recTotal.innerHTML="scx: 怎么一道题都还没有啊，快点做题了！"}pageC=Math.ceil(j/RECORDS_PER_PAGE);pageDeals()}function LoadTemplates(){strBack="";xs=new XMLSerializer();xh=new XMLHttpRequest();xh.onreadystatechange=read_ok2;xh.open("GET","templates/tot.cfg",true);xh.send(null)}function DecTemplate(){var b,c="",a="";tearr=strBack.split("\n");tetiarr=[];for(b in tearr){if(tearr[b]!=""){tearr[b]=tearr[b].replace(/[\f\n\r\v]/g,"")}}}function OpenTemplate(){if(nowId>=tearr.length){return}var a=tearr[nowId];if(a===""){return}xh.onreadystatechange=read_ok3;a="templates/"+a+".xml";xh.open("GET",a,true);xh.send(null)}function Analyze(){var d,c;var b,a;tetiarr[nowId]=xmlBack.getElementsByTagName("title")[0].childNodes[0].nodeValue;b=document.createElement("h3");b.id=tearr[nowId];b.innerHTML=tetiarr[nowId]+" [#"+tearr[nowId]+"]：";templates.appendChild(b);d=xmlBack.getElementsByTagName("pre")[0];if(d.innerXML){c=d.innerXML}else{if(d.xml){c=d.xml}else{c=xs.serializeToString(d)}}a=document.createElement("div");a.innerHTML=c;templates.appendChild(a)}function LoadMemos(){strBack="";xh=new XMLHttpRequest();xh.onreadystatechange=read_ok4;xh.open("GET","memos/tot.cfg",true);xh.send(null)}function DecMemos(){var g=0,e=0,o="",a,m=0;var c=[],n,l,k,h,f,d,b;memarr=strBack.split("\n");for(g in memarr){if(memarr[g]!==""){a=memarr[g].replace(/[\f\n\r\v]/g,"").split("|");if(a.length!==4){continue}o=a[0];c[g]=document.createElement("tr");n=c[g].insertCell();n.innerHTML=m.toString();l=c[g].insertCell();l.innerHTML=a[0];k=c[g].insertCell();h=c[g].insertCell();h.innerHTML=a[1];f=c[g].insertCell();f.innerHTML=a[2];++m;if(m<=(pageO-1)*MEMOS_PER_PAGE||pageO*MEMOS_PER_PAGE<m){c[g].style.display="none"}c[g].priority=parseInt(a[3])}}for(g=0;g<m;++g){n=c[g].cells[0];n.innerHTML=(e=m-parseInt(n.innerHTML)).toString();k=c[g].cells[2];k.innerHTML='<a href="memos/'+e+'.html" target="_blank">链接</a>'}c.sort(function(j,i){return i.priority-j.priority});for(g=0;g<m;++g){memTable.tBodies[0].appendChild(c[g])}memTotal.innerHTML="scx: 共 "+m+" 份便笺";pageC=Math.ceil(m/RECORDS_PER_PAGE);pageDeals()}function read_ok1(){if(xh.readyState===4){if(xh.status===200||xh.status===0){strBack=xh.responseText;DecRecords()}else{alert(failed)}}}function read_ok2(){if(xh.readyState===4){if(xh.status===200||xh.status===0){strBack=xh.responseText;DecTemplate();nowId=0;OpenTemplate()}else{alert(failed)}}}function read_ok3(){if(xh.readyState===4){if(xh.status===200||xh.status===0){xmlBack=xh.responseXML;if(xmlBack){Analyze()}++nowId;OpenTemplate()}else{alert(failed)}}}function read_ok4(){if(xh.readyState===4){if(xh.status===200||xh.status===0){strBack=xh.responseText;DecMemos()}else{alert(failed)}}};