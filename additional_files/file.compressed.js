var xh,xs,recarr,tearr,strBack,xmlBack;var strFilter,pageO,pageC,nowId;const RECORDS_PER_PAGE=50;const failed="今天运气不怎么好，和 scx 喝口茶再试试吧";function LoadFile(){strBack="";xh=new XMLHttpRequest();xh.onreadystatechange=read_ok1;xh.open("GET","records/tot.cfg",true);xh.send(null)}function DecFile(){var e=0,n="",a,j=0,l=0;var m,k,h,g,f,d,c,b;recarr=strBack.split("\n");for(e in recarr){if(recarr[e]!==""){a=recarr[e].replace(/[\f\n\r\v]/g,"").split("|");if(a.length!==5){continue}++l;n=a[0];if(Matching(strFilter,n)){m=recTable.tBodies[0].insertRow();k=m.insertCell();k.innerHTML=(l-1).toString();h=m.insertCell();h.innerHTML=n;g=m.insertCell();g.innerHTML='<a href="records/'+n.replace(/#/g,"%23")+'.html" target="_blank">链接</a>';f=m.insertCell();f.innerHTML=a[1];d=m.insertCell();d.innerHTML=a[2];c=m.insertCell();c.innerHTML=a[3];b=m.insertCell();b.innerHTML=a[4];++j;if(j<=(pageO-1)*RECORDS_PER_PAGE||pageO*RECORDS_PER_PAGE<j){m.style.display="none"}}}}for(e=0;e<j;++e){k=recTable.tBodies[0].rows[e].cells[0];k.innerHTML=(l-parseInt(k.innerHTML)).toString()}if(j){if(strFilter===""){recTotal.innerHTML="scx: 共做了 "+j+" 道题"}else{recTotal.innerHTML="scx: 当前筛选下共有 "+j+" 道题"}}else{recTotal.innerHTML="scx: 怎么一道题都还没有啊，快点做题了！"}pageC=Math.ceil(j/RECORDS_PER_PAGE);pageDeals()}function LoadTemplates(){strBack="";xs=new XMLSerializer();xh=new XMLHttpRequest();xh.onreadystatechange=read_ok2;xh.open("GET","templates/tot.cfg",true);xh.send(null)}function DecTemplate(){var b,c="",a="";tearr=strBack.split("\n");for(b in tearr){if(tearr[b]!=""){tearr[b]=tearr[b].replace(/[\f\n\r\v]/g,"")}}}function opening(){if(nowId>=tearr.length){return}var a=tearr[nowId];if(a===""){return}xh.onreadystatechange=read_ok3;a="templates/"+a+".xml";xh.open("GET",a,true);xh.send(null)}function Analyze(){var e,d,c;var b,a;e=xmlBack.getElementsByTagName("title")[0].childNodes[0].nodeValue;b=document.createElement("h3");b.id=tearr[nowId];b.innerHTML=e+" [#"+tearr[nowId]+"]：";templates.appendChild(b);d=xmlBack.getElementsByTagName("pre")[0];if(d.innerXML){c=d.innerXML}else{if(d.xml){c=d.xml}else{c=xs.serializeToString(d)}}a=document.createElement("div");a.innerHTML=c;templates.appendChild(a)}function read_ok1(){if(xh.readyState===4){if(xh.status===200||xh.status===0){strBack=xh.responseText;DecFile()}else{alert(failed)}}}function read_ok2(){if(xh.readyState===4){if(xh.status===200||xh.status===0){strBack=xh.responseText;DecTemplate();nowId=0;opening()}else{alert(failed)}}}function read_ok3(){if(xh.readyState===4){if(xh.status===200||xh.status===0){xmlBack=xh.responseXML;if(xmlBack){Analyze()}++nowId;opening()}else{alert(failed)}}};